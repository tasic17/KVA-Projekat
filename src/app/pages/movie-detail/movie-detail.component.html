<div class="movie-detail-container">
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <div *ngIf="!loading && error" class="not-found">
    <h2>{{ errorMessage || 'Movie not found' }}</h2>
    <p>The movie you're looking for doesn't exist or could not be loaded.</p>
    <div class="error-actions">
      <a mat-raised-button color="primary" routerLink="/movies">Back to Movies</a>
      <button mat-raised-button (click)="retry()">Try Again</button>
    </div>
  </div>

  <div *ngIf="!loading && movie && !error" class="movie-content">
    <div class="movie-header">
      <div class="movie-poster-container">
        <img
          [src]="movie?.coverUrl || 'assets/images/movie-placeholder.jpg'"
          [alt]="movie?.title"
          class="movie-poster"
          onerror="this.src='assets/images/movie-placeholder.jpg'">
      </div>

      <div class="movie-info">
        <h1>{{ movie?.title }}</h1>

        <div class="movie-meta">
          <div class="movie-runtime" *ngIf="movie?.runtime">
            <mat-icon>schedule</mat-icon>
            <span>{{ movie?.runtime }} minutes</span>
          </div>

          <div class="movie-release" *ngIf="movie?.releaseDate">
            <mat-icon>event</mat-icon>
            <span>{{ formatDate(movie?.releaseDate) }}</span>
          </div>
        </div>

        <div class="movie-genres" *ngIf="movie?.genres && movie?.genres.length > 0">
          <mat-chip-set>
            <mat-chip *ngFor="let genre of movie?.genres || []">{{ genre?.name }}</mat-chip>
          </mat-chip-set>
        </div>

        <div class="movie-description">
          <p>{{ movie?.description }}</p>
        </div>

        <div class="movie-crew">
          <div class="directors">
            <h3>Director{{ movie?.directors && movie?.directors.length > 1 ? 's' : '' }}</h3>
            <p>{{ getDirectorNames() }}</p>
          </div>

          <div class="cast" *ngIf="movie?.actors && movie?.actors.length > 0">
            <h3>Cast</h3>
            <p>{{ getActorNames() }}</p>
          </div>
        </div>
      </div>
    </div>

    <mat-tab-group class="movie-details-tabs">
      <mat-tab label="Screenings">
        <div class="tab-content">
          <div *ngIf="screenings.length === 0" class="no-screenings">
            <p>No upcoming screenings available for this movie.</p>
          </div>

          <div *ngIf="screenings.length > 0" class="screenings-list">
            <div *ngFor="let screening of screenings" class="screening-item">
              <div class="screening-info">
                <div class="screening-date">
                  <div class="date-day">{{ formatDateDay(screening?.date) }}</div>
                  <div class="date-full">{{ formatDateMonthDay(screening?.date) }}</div>
                </div>

                <div class="screening-time">
                  <mat-icon>schedule</mat-icon>
                  <span>{{ screening?.time }}</span>
                </div>

                <div class="screening-hall">
                  <mat-icon>chair</mat-icon>
                  <span>{{ screening?.hall }}</span>
                </div>

                <div class="screening-seats" [ngClass]="{'low-seats': screening?.availableSeats < 10}">
                  <mat-icon>event_seat</mat-icon>
                  <span>{{ screening?.availableSeats }} seats available</span>
                </div>

                <div class="screening-price">
                  <span>{{ screening?.price }} RSD</span>
                </div>
              </div>

              <div class="screening-actions">
                <button mat-raised-button color="accent" (click)="addToCart(screening)"
                        [disabled]="screening?.availableSeats === 0">
                  Add to Cart
                </button>
              </div>
            </div>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="Cast">
        <div class="tab-content">
          <div *ngIf="!movie?.actors || movie?.actors?.length === 0" class="no-cast">
            <p>No cast information available for this movie.</p>
          </div>

          <div *ngIf="movie?.actors && movie?.actors?.length > 0" class="cast-list">
            <div *ngFor="let actor of movie?.actors || []" class="cast-item">
              <mat-icon>person</mat-icon>
              <div class="cast-info">
                <div class="actor-name">{{ actor?.name }}</div>
              </div>
            </div>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>
